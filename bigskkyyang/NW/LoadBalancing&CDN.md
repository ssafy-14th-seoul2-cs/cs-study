# 로드밸런싱 & CDN

## 로드밸런싱 (Load Balancing)로드밸런싱이란?
- 로드밸런싱은 서버에 가해지는 부하(load)를 분산(balancing)시켜주는 기술
- 한 대의 서버가 모든 요청을 처리하는 게 아니라 여러 대의 서버가 나눠서 처리하도록 만드는 것
- ex. 쇼핑몰 사이트에 동시에 1만 명이 접속하면 서버 한 대로는 감당x -> 이때 로드밸런서가 이 1만 명을 여러 서버로 적절히 분배
 
## 로드밸런싱을 사용하는 이유
- 서버 과부하 방지: 트래픽을 여러 서버로 분산시켜 한 서버에 부담이 집중되는 걸 막는다.
- 서비스 안정성: 한 서버가 다운되어도 다른 서버가 있어서 서비스가 계속 운영된다.
- 확장성: 트래픽이 늘어나면 서버를 추가하기만 하면 된다.
- 빠른 응답 속도: 여러 서버가 동시에 처리하니까 사용자 입장에서 빠르게 느껴진다.

## 로드밸런싱 알고리즘

### 1. Round Robin (라운드 로빈)
- 가장 단순한 방식으로, 서버들에게 순서대로 돌아가며 요청을 분배한다.
- 서버1 → 서버2 → 서버3 → 서버1 → 서버2 ...
- 각 서버의 성능이 비슷할 때 적합하다.

### 2. Least Connection (최소 연결)
- 현재 연결된 클라이언트 수가 가장 적은 서버로 요청을 보낸다.
- 요청 처리 시간이 제각각일 때 유용하다.

### 3. IP Hash
- 클라이언트의 IP 주소를 기반으로 항상 같은 서버로 연결한다.
- 세션 유지가 필요한 경우에 좋다.
- 같은 사용자는 계속 같은 서버와 통신하게 된다.

### 4. Weighted (가중치)
- 서버마다 성능이 다를 때, 성능이 좋은 서버에 더 많은 요청을 보낸다.

## L4와 L7 로드밸런싱
로드밸런서는 OSI 7계층 중 어느 계층에서 동작하느냐에 따라 나뉜다.

### L4 로드밸런싱 (전송 계층)
- IP 주소와 Port 번호를 보고 분산시킨다.
- 빠르고 효율적이지만 단순하다.
- 예: 192.168.0.1:80 → 서버1로, 192.168.0.2:80 → 서버2로

### L7 로드밸런싱 (응용 계층)
- HTTP 헤더, URL, 쿠키 등의 정보를 보고 더 똑똑하게 분산시킨다.
- L4보다 느리지만 더 세밀한 제어가 가능하다.
- 예: /image로 오는 요청은 이미지 서버로, /api로 오는 요청은 API 서버로

## CDN (Content Delivery Network)
- CDN은 전 세계 여러 곳에 서버(엣지 서버)를 두고, 사용자와 가장 가까운 서버에서 콘텐츠를 제공하는 서비스

### CDN의 동작 원리
1. 초기 상태

원본 서버(Origin Server)에 모든 콘텐츠가 있다
전 세계 곳곳에 CDN 서버(엣지 서버)들이 대기하고 있다

2. 첫 요청 시

한국 사용자가 이미지를 요청한다
한국 CDN 서버에 해당 이미지가 없으면 원본 서버에서 가져온다
가져온 이미지를 한국 CDN 서버에 저장(캐싱)한다
사용자에게 이미지를 전달한다

3. 이후 요청 시

다른 한국 사용자가 같은 이미지를 요청한다
이미 한국 CDN 서버에 캐싱되어 있으니 바로 전달
원본 서버까지 갈 필요가 없어서 훨씬 빠르다

### CDN의 장점

1. 빠른 로딩 속도

지리적으로 가까운 서버에서 콘텐츠를 받으니까 빠르다

2. 원본 서버 부하 감소

CDN 서버가 대부분의 요청을 처리해줘서 원본 서버는 한가해진다
트래픽이 몰려도 원본 서버는 안정적

3. 대역폭 비용 절감

원본 서버에서 데이터를 전송하는 횟수가 줄어들어서 비용이 절약된다
특히 이미지나 동영상같이 용량이 큰 파일에 효과적

4. 보안 향상

DDoS 공격 같은 대규모 공격을 CDN이 분산시켜서 막아준다
원본 서버를 숨길 수 있어서 직접적인 공격을 방어

5. 가용성 향상

한 지역의 서버가 다운되어도 다른 지역 서버에서 제공할 수 있다
항상 서비스가 운영되도록 보장한다

### CDN 사용 사례
CDN은 주로 **정적 콘텐츠(Static Content)**를 제공할 때 사용된다.

이미지, 동영상: 용량이 크고 자주 바뀌지 않음
CSS, JavaScript 파일: 웹사이트 디자인과 기능 파일들
다운로드 파일: PDF, 소프트웨어 설치 파일 등
스트리밍: 넷플릭스, 유튜브 같은 동영상 서비스

반대로 **동적 콘텐츠(Dynamic Content)**는 사용자마다 다르게 보여야 하니까 캐싱하기 어렵다. 예를 들어 로그인 정보, 실시간 채팅, 개인화된 추천 등