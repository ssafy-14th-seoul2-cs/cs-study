# DNS & DHCP

## 개요

인터넷을 편리하게 사용할 수 있게 해주는 두 가지 핵심 프로토콜

- **DNS**: 도메인 이름을 IP 주소로 바꿔주는 시스템
- **DHCP**: IP 주소를 자동으로 할당해주는 프로토콜

---

## DNS (Domain Name System)

### 개념

**도메인 네임 시스템**
사람이 이해하기 쉬운 도메인 이름을 컴퓨터가 이해하는 IP 주소로 변환해준다.

### 필요성

#### 문제 상황
```
구글에 접속하려면?
- 실제 주소: 142.250.196.110
- 기억하기 어려움
```

#### 해결책
```
www.google.com 입력 → DNS가 142.250.196.110로 변환
                    → 접속 성공!
```

### 도메인 구조

도메인은 계층 구조로 되어 있어.

```
www.naver.com.
 │   │    │  │
 │   │    │  └─ 루트(Root) - 생략됨
 │   │    └─ 최상위 도메인(TLD) - Top Level Domain
 │   └─ 2차 도메인(SLD) - Second Level Domain  
 └─ 서브 도메인(Subdomain) 또는 호스트명
```

**계층별 예시**
```
.                          ← 루트 도메인
├── .com                   ← 최상위 도메인 (TLD)
│   ├── google.com         ← 2차 도메인 (SLD)
│   │   ├── www.google.com     ← 호스트명
│   │   ├── mail.google.com    ← 호스트명
│   │   └── drive.google.com   ← 호스트명
│   └── naver.com
├── .kr                    ← 국가 코드 TLD
│   └── .co.kr
│       └── naver.co.kr
└── .net
```

**주요 최상위 도메인(TLD)**
- **.com**: 상업용 (가장 많이 사용)
- **.net**: 네트워크 관련
- **.org**: 비영리 단체
- **.edu**: 교육 기관
- **.gov**: 정부 기관
- **.kr**: 대한민국
- **.jp**: 일본

### DNS 동작 과정

브라우저에 `www.naver.com` 입력하면?

```
[1단계: 로컬 캐시 확인]
내 컴퓨터 DNS 캐시 확인
    ↓ 없으면
    
[2단계: Recursive DNS 서버에 질의]
내 컴퓨터 → DNS 서버 (통신사/구글 DNS)
"www.naver.com의 IP 주소 알려줘!"
    ↓
    
[3단계: 루트 DNS 서버에 질의]
Recursive DNS → 루트 DNS 서버
"www.naver.com 어디서 찾아?"
루트: ".com은 여기로 가봐!" (TLD DNS 서버 주소)
    ↓
    
[4단계: TLD DNS 서버에 질의]
Recursive DNS → .com TLD DNS 서버
"naver.com 어디 있어?"
TLD: "naver.com은 여기로 가봐!" (권한 있는 DNS 서버 주소)
    ↓
    
[5단계: 권한 있는 DNS 서버에 질의]
Recursive DNS → naver.com의 DNS 서버
"www.naver.com의 IP 주소는?"
Naver DNS: "223.130.200.107이야!"
    ↓
    
[6단계: 응답]
Recursive DNS → 내 컴퓨터
"www.naver.com = 223.130.200.107"
    ↓
    
[7단계: 접속]
내 컴퓨터 → 223.130.200.107로 접속! ✅
```

### DNS 레코드 타입

DNS 서버에 저장되는 정보 종류

| 레코드 타입 | 설명 | 예시 |
|-----------|------|------|
| **A** | 도메인 → IPv4 주소 | naver.com → 223.130.200.107 |
| **AAAA** | 도메인 → IPv6 주소 | google.com → 2404:6800:4004::68 |
| **CNAME** | 도메인 → 다른 도메인 (별칭) | www.example.com → example.com |
| **MX** | 메일 서버 주소 | naver.com → mail.naver.com |
| **NS** | 네임서버 정보 | naver.com → ns1.naver.com |
| **TXT** | 텍스트 정보 | 도메인 소유 확인, SPF 레코드 등 |
| **PTR** | IP 주소 → 도메인 (역방향) | 1.2.3.4 → example.com |

### DNS 캐싱

매번 이렇게 복잡하게 찾으면 느림 -> **캐싱**을 사용

```
[캐시 단계별]
1순위: 브라우저 캐시 (Chrome, Edge 등)
2순위: 운영체제 캐시 (Windows, Mac)
3순위: 라우터 캐시
4순위: ISP DNS 캐시 (통신사)
5순위: 실제 DNS 조회 (위 과정 수행)
```

**TTL (Time To Live)**
- 캐시를 얼마나 오래 보관할지 결정하는 시간
- 예: TTL=3600 → 1시간 동안 캐시에 저장

```
naver.com  3600  IN  A  223.130.200.107
           ↑
           TTL (초 단위)
```

### 주요 DNS 서버

**공개 DNS 서버**

| 제공자 | Primary DNS | Secondary DNS |
|-------|------------|---------------|
| **Google** | 8.8.8.8 | 8.8.4.4 |
| **Cloudflare** | 1.1.1.1 | 1.0.0.1 |
| **Quad9** | 9.9.9.9 | 149.112.112.112 |
| **KT** | 168.126.63.1 | 168.126.63.2 |

**왜 구글 DNS를 쓸까?**
- 빠른 응답 속도
- 안정성
- 프라이버시 (일부 공개 DNS)

### DNS 보안 위협

#### DNS 스푸핑 (DNS Spoofing)
가짜 DNS 응답으로 사용자를 속이는 공격

```
정상:
naver.com 질의 → 진짜 DNS → 223.130.200.107

공격:
naver.com 질의 → 해커의 가짜 DNS → 해커 서버 IP
                                   ↓
                            가짜 네이버 사이트!
```

#### DNS 캐시 포이즈닝
DNS 캐시에 가짜 정보를 넣는 공격

**방어 방법**
- **DNSSEC**: DNS 보안 확장 (서명으로 위변조 방지)
- **DoH (DNS over HTTPS)**: HTTPS로 DNS 요청 암호화
- **DoT (DNS over TLS)**: TLS로 DNS 요청 암호화

---

## DHCP (Dynamic Host Configuration Protocol)

### 개념

**동적 호스트 구성 프로토콜**
네트워크에 연결된 기기에 자동으로 IP 주소를 할당해줘!

### 필요성

#### 수동 설정의 문제
```
[50명이 있는 사무실]
직원 1: IP 192.168.0.2, 서브넷 255.255.255.0, 게이트웨이...
직원 2: IP 192.168.0.3, 서브넷...
직원 3: IP...
...
일일이 설정해야 해
IP 중복 위험
설정 실수
```

#### DHCP의 해결
```
[DHCP 서버 설치]
직원 1: 네트워크 연결! → 자동으로 설정 완료!
직원 2: 네트워크 연결! → 자동으로 설정 완료!
직원 3: 네트워크 연결! → 자동으로 설정 완료!
```

### DHCP가 제공하는 정보

네트워크 접속에 필요한 모든 정보를 한 번에 준다.

```
✅ IP 주소 (예: 192.168.0.100)
✅ 서브넷 마스크 (예: 255.255.255.0)
✅ 기본 게이트웨이 (예: 192.168.0.1)
✅ DNS 서버 주소 (예: 8.8.8.8)
✅ 임대 시간 (Lease Time)
```

### DHCP 동작 과정 (DORA)

4단계로 진행됨 -> **DORA**

#### 1️⃣ Discover (발견)
```
[클라이언트] → [브로드캐스트]
"DHCP 서버 있어요? IP 주소 주세요!"
출발: 0.0.0.0 (아직 IP 없음)
목적: 255.255.255.255 (전체에게 알림)
```

#### 2️⃣ Offer (제안)
```
[DHCP 서버] → [클라이언트]
"여기 있어요! 이 IP 주소 어때요?"
제안: 192.168.0.100
임대 시간: 24시간
DNS: 8.8.8.8
게이트웨이: 192.168.0.1
```

#### 3️⃣ Request (요청)
```
[클라이언트] → [브로드캐스트]
"네, 그 IP 주소로 할게요!"
(여러 DHCP 서버가 있을 수 있어서 선택한 서버에 알림)
```

#### 4️⃣ Acknowledge (확인)
```
[DHCP 서버] → [클라이언트]
"확인! 이제 그 IP 사용해도 돼요!"
→ 클라이언트가 IP 주소 사용 시작
```

### IP 주소 임대 (Lease)

DHCP는 IP 주소를 **임대**하는 개념

**임대 시간 (Lease Time)**
```
일반적인 설정: 24시간 (86400초)

타임라인:
0시간 ─────── 12시간 ─────── 18시간 ─────── 24시간
  ↑              ↑              ↑              ↑
시작           갱신 시도1     갱신 시도2      임대 만료
```

**임대 갱신 (Renewal)**
```
임대 시간 50% 지점 (12시간): 
→ 클라이언트가 DHCP 서버에 갱신 요청
→ 성공하면 임대 시간 연장

임대 시간 87.5% 지점 (21시간):
→ 아직 갱신 안 됐으면 다시 시도
→ 성공하면 연장

임대 만료:
→ IP 주소 반납
→ 다시 DORA 과정 진행
```

### IP 주소 풀 (Address Pool)

DHCP 서버가 할당할 수 있는 IP 주소 범위

**예시 설정**
```
네트워크: 192.168.0.0/24
서브넷 마스크: 255.255.255.0
사용 가능: 192.168.0.1 ~ 192.168.0.254

DHCP 설정:
- 시작 IP: 192.168.0.100
- 끝 IP: 192.168.0.200
- 할당 가능: 101개

고정 IP 영역:
- 192.168.0.1 ~ 192.168.0.99 (서버, 프린터 등)
- 192.168.0.201 ~ 192.168.0.254 (예약)
```

### 고정 IP vs 동적 IP

| 구분 | 동적 IP (DHCP) | 고정 IP (Static) |
|------|---------------|-----------------|
| **할당** | 자동 | 수동 설정 |
| **변경** | 주기적으로 변경 가능 | 고정됨 |
| **관리** | 쉬움 | 어려움 |
| **용도** | 일반 사용자 PC, 스마트폰 | 서버, 프린터, NAS |
| **장점** | 편리, 중복 방지 | 항상 같은 주소 |
| **단점** | 주소가 바뀔 수 있음 | 일일이 설정 필요 |

### DHCP 예약 (Reservation)

특정 기기에는 항상 같은 IP를 줄 수 있음

```
[DHCP 예약 설정]
MAC 주소: AA:BB:CC:DD:EE:FF (프린터)
→ 항상 192.168.0.50 할당

MAC 주소: 11:22:33:44:55:66 (서버)
→ 항상 192.168.0.51 할당

장점:
✅ DHCP의 편리함 유지
✅ 고정 IP처럼 주소 고정
✅ 중앙에서 관리 가능
```

### DHCP 릴레이 (Relay)

DHCP는 브로드캐스트를 사용하는데, 브로드캐스트는 **라우터를 넘어갈 수 없음**

**문제 상황**
```
[서브넷 A]         [라우터]         [서브넷 B]
클라이언트                         DHCP 서버
    |                                  |
    |--Discover(브로드캐스트)->|      |
                              ❌ 못 넘어감!
```

**해결: DHCP 릴레이**
```
[서브넷 A]         [라우터]         [서브넷 B]
클라이언트        (릴레이 에이전트)   DHCP 서버
    |                 |                 |
    |-Discover(브로드캐스트)->|          |
    |                  |-Discover(유니캐스트)→|
    |                  |←-Offer-------------|
    |←-Offer---------|                  |
```

---

## DNS와 DHCP의 관계

이 두 프로토콜은 **함께 작동**해서 편리한 인터넷 환경을 만든다.

### 순서
```
1단계: 네트워크 연결
   ↓
[DHCP] IP 주소, DNS 서버 주소 받기
"너의 IP는 192.168.0.100이고, DNS는 8.8.8.8 써!"
   ↓
   
2단계: 웹사이트 접속
   ↓
[DNS] 도메인 이름 → IP 주소 변환
"www.naver.com은 223.130.200.107이야!"
   ↓
   
3단계: 실제 접속
웹사이트에 연결!
```
