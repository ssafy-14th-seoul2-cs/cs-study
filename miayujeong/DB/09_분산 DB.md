## 📖 **분산 데이터베이스 (Distributed Database)**

### 분산 DB란?

#### vs. 중앙 집중형 DB

: 데이터베이스 시스템 구축 시 한 대의 물리적 시스템에 DBMS를 설치하고, 여러 사용자가 접속해 사용하는 구조

#### 분산 DB

- **여러 물리적 위치(서버/노드)에 데이터를 나누어 저장하고 운영**하는 데이터베이스 시스템
- 사용자 입장에서는 하나의 DB처럼 인식 (=투명성)

<br>

### 등장 배경

| 문제 | 설명 |
| --- | --- |
| 트래픽 증가 | 단일 서버의 한계(CPU, I/O, 메모리) |
| 데이터 증가 | 수 TB–PB급 데이터 저장 필요 |
| 장애 대응 필요 | 단일 장애점(Single Point of Failure) 제거 |
| 글로벌 서비스 | 지역별 지연(latency) 감소 |

<br>

### 분산 DB의 투명성 (Transperancy)

: 여러 노드에 존재하는 분산 DB가 사용자에게 하나의 DB처럼 느껴지기 위해 필요한 특성

| 투명성 | 설명 |
| --- | --- |
| **분할 투명성 (Fragmentation Transparency)** | 하나의 논리 릴레이션이 여러 조각(단편)으로 저장되어 있어도, 사용자는 이를 인식할 필요 없음. |
| **위치 투명성 (Location Transparency)** | 데이터가 어느 노드에 저장되어 있는지 알 필요 없음. 동일한 명령으로 접근 가능. |
| **지역 사상 투명성 (Local Mapping Transparency)** | 각 지역 DBMS 이름과 관계없이 전역 스키마 기반으로 접근 가능. |
| **중복 투명성 (Replication Transparency)** | 여러 노드에 데이터 사본이 있더라도 사용자는 이를 신경 쓸 필요 없고, 항상 일관된 데이터 제공. |
| **장애 투명성 (Failure Transparency)** | 일부 노드/네트워크 장애가 발생해도 전체 트랜잭션의 무결성과 일관성 보장. |
| **병행 투명성 (Concurrency Transparency)** | 여러 사용자가 동시에 트랜잭션을 실행해도, 일관된 결과 유지. |

<br>

## 📖 분산 DB의 핵심 개념

### CAP 이론

- 분산 시스템의 3대 특성 (Consistency, Availability, Partition Tolerance)은 동시에 충족될 수 없음
- 3대 특성
    
    
    |  |  |
    | --- | --- |
    | **Consistency (일관성)** | 모든 노드가 동일한 데이터 보장 |
    | **Availability (가용성)** | 언제든 응답  |
    | **Partition Tolerance (분할 허용)** | 네트워크 분리 상황에서도 운영  |
- ⇒ 분산 DB는 CP or AP 중 선택해야 함
    
    
    | 시스템 | 선택 |
    | --- | --- |
    | **CP (일관성, 분할 허용)** | Strong Consistency 중요 → MongoDB(옵션), HBase |
    | **AP (가용성, 분할 허용)** | Availability 중요 → Cassandra, DynamoDB |

<br>

### Replication (복제)

- 동일 데이터를 여러 노드에 저장하여 읽기 성능, 가용성, 장애 대응 향상

#### 복제 방식에 따른 종류 

|  |  |
| --- | --- |
| **Master–Slave** | Master가 쓰기, Slave는 읽기 전용 |
| **Master–Master** | 여러 노드가 동시에 쓰기 가능 |
| **Sync Replication** | 모든 Replica 반영 후 커밋 → 강한 일관성 |
| **Async Replication** | Master 먼저 커밋 → 높은 가용성 |

<br>

### Sharding (샤딩 — 수평 분할)

- 데이터를 행(row) 기준으로 수평 분할해 여러 노드에 분할 저장

#### 샤딩의 필요성 

- 데이터가 너무 커서 한 서버에 저장 불가
- 읽기/쓰기 병목 제거

#### 샤딩 전략

|  |  |
| --- | --- |
| **Range Sharding** | 특정 범위 기반 분할 |
| **Hash Sharding** | 해시함수 기반 → 균등 분산에 유리 |
| **Geographic Sharding** | 지역별 분산 (KR, JP, US) |
| **Directory Sharding** | 중앙 매핑 테이블로 샤드 위치 관리 |

<br>

### 분산 트랜잭션 (Distributed Transaction)

- 여러 노드에 걸친 작업을 하나의 트랜잭션처럼 처리해야 함

#### Two-Phase Commit (2PC)

|  |  |  |
| --- | --- | --- |
| **1단계** | **Prepare** | 각 노드에 "커밋 준비 가능?" 요청 |
| **2단계**  | **Commit** | 모든 노드 OK → Commit, 한 곳이라도 실패 → Rollback |
- 하나의 노드가 멈추면 전체 트랜잭션이 지연
- 네트워크 장애에 매우 취약 → 확장성 떨어짐

<br>

## 📖 분산 DB 설계 방식

### 상향식 (Bottom-up)

- 지역별 DB 먼저 구축 → 이후 전역 스키마(Global Schema)로 통합
- 기존 시스템 통합 시 유리
- 지역 시스템 특성을 잘 유지
- 통합 시 스키마 충돌 가능

<br>

### 하향식 (Top-down)

- 전사적 데이터 모델 설계 → 지역 스키마 분리
- 전체 구조가 통일됨
- 중복·비일관성 감소
- 초기 설계 비용 큼, 시간 오래 걸림

<br>

## 📖 분산 DB의 장단점

| 장점 | 단점 |
| --- | --- |
| 고가용성 (Availability ↑) | 설계가 복잡함 |
| 빠른 응답속도 (지역 분산) | 네트워크 비용·지연 |
| 장애 감내 능력 ↑ | 보안 관리 어려움 |
| 수평 확장성 뛰어남 | 데이터 무결성 유지 어려움 |
| 병렬 처리로 성능 향상 | 운영 및 모니터링 어려움 |

<br>

## 📖 분산 DB 적용

### 적용할 곳

- 성능이 중요할 때
- 공통 코드, 기준 정보, 마스터 데이터 등에 대해 분산 설계 적용하면 성능 향상됨
- 실시간 동기화가 요구되지 않을 때
- 특정 서버에 부하가 집중될 때
- 백업 사이트를 구성할 때

<br>

### 대표적인 분산 DB 시스템

|  |  |
| --- | --- |
| **Google Spanner** | TrueTime 기반 글로벌 강일관성 |
| **Cassandra** | AP 지향, 고가용성, NoSQL |
| **MongoDB (Sharded Cluster)** | 범용 Document DB, 샤딩/복제 지원 |
| **CockroachDB** | Spanner 스타일 CP + SQL 지원 |
| **DynamoDB** | AWS Fully Managed NoSQL 서비스 |