# 🧱 데이터베이스 정규화 & 반정규화

> 데이터베이스 설계의 핵심 목표는 **데이터의 일관성(Consistency)** 과 **효율적인 관리(Maintainability)** 입니다.
>
> 이를 위해 설계 단계에서 **정규화(Normalization)** 와 **반정규화(Denormalization)** 를 적절히 활용합니다.

---

## 📘 1️⃣ 정규화 (Normalization)

> **중복 데이터를 제거하고, 이상 현상(Anomaly)을 방지하기 위한 테이블 구조화 과정**

정규화는 데이터를 여러 개의 관계형 테이블로 나누어
**데이터 중복 최소화 + 데이터 무결성 보장**을 목표로 합니다.

---

### ⚙️ 정규화의 목적

| 목적                 | 설명                        |
| ------------------ | ------------------------- |
| **데이터 중복 제거**      | 동일한 데이터가 여러 곳에 존재하지 않도록 함 |
| **데이터 무결성 보장**     | 갱신, 삭제, 삽입 시 불일치 발생 방지    |
| **이상(Anomaly) 방지** | 불필요한 데이터 변경으로 인한 오류 예방    |
| **유지보수성 향상**       | 구조가 명확해 관리 및 확장 용이        |

---

### ⚠️ 정규화로 방지되는 이상(Anomaly)

| 구분                            | 설명                                | 예시                          |
| ----------------------------- | --------------------------------- | --------------------------- |
| **삽입 이상 (Insertion Anomaly)** | 특정 데이터를 넣기 위해 불필요한 데이터도 넣어야 하는 문제 | 고객 정보만 추가하고 싶어도 주문 정보가 필요   |
| **갱신 이상 (Update Anomaly)**    | 같은 데이터가 여러 곳에 중복되어 수정 시 누락 가능     | 고객 주소가 여러 레코드에 중복되어 일부만 변경됨 |
| **삭제 이상 (Deletion Anomaly)**  | 한 데이터를 삭제할 때 연관된 다른 정보까지 손실       | 주문 정보 삭제 시 고객 정보까지 삭제됨      |

---

## 🧩 2️⃣ 정규화의 단계 (Normal Forms)

| 정규형            | 정의                            | 해결하는 문제                | 예시                       |
| -------------- | ----------------------------- | ---------------------- | ------------------------ |
| **1정규형 (1NF)** | 모든 속성값은 **원자값(Atomic)** 이어야 함 | 컬럼에 여러 값이 들어있는 문제 해결   | `phone1, phone2 → phone` |
| **2정규형 (2NF)** | 부분적 종속 제거 (기본키 일부에만 종속 X)     | 복합키 사용 시 일부 컬럼만 종속된 문제 | 주문ID + 상품ID → 상품명        |
| **3정규형 (3NF)** | 이행적 종속 제거 (비키가 다른 비키에 종속 X)   | 컬럼 간 종속성 제거            | 고객ID → 지역ID → 지역명        |
| **BCNF**       | 결정자가 후보키가 아닌 함수 종속 제거         | 고급 함수 종속 문제 해결         | 강의-교수 관계 등               |
| **4NF**        | 다중값 종속 제거                     | 한 엔티티에 여러 다중값 속성 존재    | 학생 → {전공, 자격증}           |
| **5NF**        | 조인 종속 제거                      | 조인 시 데이터 손실 방지         | 관계가 너무 세분화된 경우           |

> 💡 실무에서는 보통 **3정규형(3NF)** 까지만 적용해도 충분합니다.
> 너무 세분화하면 성능 저하와 조인 복잡도가 커지기 때문입니다.

---

## 📊 예시로 보는 정규화 과정

### 🎯 초기 테이블 (비정규형)

| 고객ID | 고객명 | 상품ID | 상품명 | 주문수량 |
| ---- | --- | ---- | --- | ---- |
| C01  | 동현  | P01  | 키보드 | 1    |
| C01  | 동현  | P02  | 마우스 | 2    |

→ 고객 이름이 중복되고, 수정/삭제 시 이상 발생

---

### ✅ 1차 정규화 (1NF)

| 고객ID | 고객명 |
| ---- | --- |
| C01  | 동현  |

| 상품ID | 상품명 |
| ---- | --- |
| P01  | 키보드 |
| P02  | 마우스 |

| 주문ID | 고객ID | 상품ID | 수량 |
| ---- | ---- | ---- | -- |
| O01  | C01  | P01  | 1  |
| O02  | C01  | P02  | 2  |

→ 데이터 중복 제거, 이상 방지, 구조 명확

---

## 🧱 3️⃣ 반정규화 (Denormalization)

> **조회 성능 향상을 위해 의도적으로 중복을 허용하는 설계 기법**

정규화는 이상을 방지하지만, **JOIN이 많아질수록 조회 속도가 느려집니다.**
이를 개선하기 위해 DB에서는 **반정규화**를 적용하기도 합니다.

---

### ⚙️ 반정규화의 목적

| 목적                  | 설명                 |
| ------------------- | ------------------ |
| **조회 성능 향상**        | 조인 없이 빠른 SELECT 가능 |
| **복잡한 조인 단순화**      | 단일 테이블로 조회         |
| **OLAP, 통계 처리 최적화** | 다차원 데이터 분석 시 사용    |

---

### 🧮 반정규화 기법

| 기법            | 설명                    | 예시                         |
| ------------- | --------------------- | -------------------------- |
| **테이블 병합**    | 자주 조인되는 테이블을 하나로 통합   | 고객 + 주문                    |
| **컬럼 중복**     | 다른 테이블의 컬럼을 복사해 저장    | 주문 테이블에 고객 이름 추가           |
| **파생 컬럼 추가**  | 계산 결과를 미리 저장          | 합계, 평균 컬럼 추가               |
| **이력 테이블 분리** | 변경 이력 별도 관리           | 주문_이력 테이블                  |
| **수직 분할**     | 자주 조회되는 컬럼만 따로 분리     | `UserMain`, `UserDetail`   |
| **수평 분할**     | 데이터 양이 많을 때 행 기준으로 분리 | `Order_2024`, `Order_2025` |

---

### 📈 반정규화의 단점

| 항목             | 설명                    |
| -------------- | --------------------- |
| **데이터 중복 증가**  | 저장 공간 낭비              |
| **데이터 불일치 위험** | 중복된 데이터의 일부만 갱신될 수 있음 |
| **무결성 제약 약화**  | 외래키 제약 적용이 어려움        |
| **유지보수성 저하**   | 테이블 구조 변경 시 영향 큼      |

---

## ⚖️ 정규화 vs 반정규화 비교표

| 구분        | 정규화               | 반정규화                |
| --------- | ----------------- | ------------------- |
| **목적**    | 데이터 중복 최소화, 이상 방지 | 조회 성능 향상            |
| **장점**    | 무결성 유지, 구조 명확     | 조회 속도 향상            |
| **단점**    | 조인 비용 증가          | 중복, 일관성 문제          |
| **적합 환경** | 트랜잭션 중심 시스템(OLTP) | 분석/리포트 중심 시스템(OLAP) |
| **대표 예시** | 은행 거래, 쇼핑몰 주문     | 데이터웨어하우스, 통계 분석     |

---

## 🧠 5️⃣ 정규화와 반정규화의 조화

* **정규화**: 데이터 무결성 확보를 위한 **설계 단계의 기본 원칙**
* **반정규화**: **성능 문제** 발생 시 선택적으로 적용하는 **튜닝 전략**

> 💡 실무에서는 **기본적으로 정규화 → 필요 시 반정규화**
> 즉, **정규화를 기본으로 설계하고, 병목이 생길 때 반정규화로 최적화** 합니다.

---

## ✅ 요약

| 항목                         | 설명                            |
| -------------------------- | ----------------------------- |
| **정규화 (Normalization)**    | 데이터 중복을 제거하고 무결성을 높이는 설계 과정   |
| **반정규화 (Denormalization)** | 조인 비용을 줄이기 위해 중복을 허용하는 최적화 과정 |
| **적용 순서**                  | 정규화로 설계 후, 성능 개선을 위해 반정규화     |
| **실무 원칙**                  | “정확성 우선, 성능은 튜닝으로 해결”         |

---
