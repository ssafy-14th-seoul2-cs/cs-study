# ğŸ§± Singleton & Factory ë””ìì¸ íŒ¨í„´ ì •ë¦¬

---

## 1ï¸âƒ£ ì‹±ê¸€í†¤ íŒ¨í„´ (Singleton Pattern)

### ğŸ“Œ ê°œë…

> **ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ì˜¤ì§ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” íŒ¨í„´**

ì˜ˆ:

* ì„¤ì • ê´€ë¦¬ ê°ì²´ (Config)
* ë¡œê·¸ ê´€ë¦¬ì (Logger)
* DB ì—°ê²° ê´€ë¦¬ì (Connection Manager) ë“±

---

### âœ… í•µì‹¬ í¬ì¸íŠ¸

1. **ìƒì„±ìë¥¼ ì™¸ë¶€ì—ì„œ ë§ˆìŒëŒ€ë¡œ ëª» ì“°ê²Œ ì œì–´í•œë‹¤.**
2. **í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ë‹¨ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ìœ ì§€í•œë‹¤.**
3. **ê·¸ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ì „ì—­ì ì¸ ë©”ì„œë“œ/ë°©ì‹ì„ ì œê³µí•œë‹¤.**

íŒŒì´ì¬ì€ ì–¸ì–´ íŠ¹ì„±ìƒ ì‚´ì§ ë‹¤ë¥´ê²Œ êµ¬í˜„í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

---

### ğŸ§© ì˜ˆì‹œ 1: `__new__` ë¥¼ ì´ìš©í•œ Singleton

```python
class Singleton:
    _instance = None

    def __new__(cls, *args, **kwargs):
        if cls._instance is None:
            # ìµœì´ˆ ìƒì„±
            cls._instance = super().__new__(cls)
        return cls._instance

    def __init__(self, value=None):
        # __init__ì€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜
        if value is not None:
            self.value = value


# ì‚¬ìš© ì˜ˆì‹œ
s1 = Singleton(10)
s2 = Singleton(20)

print(s1 is s2)       # True
print(s1.value)       # 20 (ë§ˆì§€ë§‰ init ê¸°ì¤€)
print(s2.value)       # 20
```

---

### ğŸ§© ì˜ˆì‹œ 2: ë°ì½”ë ˆì´í„°ë¡œ Singleton ë§Œë“¤ê¸°

```python
def singleton(cls):
    instances = {}

    def get_instance(*args, **kwargs):
        if cls not in instances:
            instances[cls] = cls(*args, **kwargs)
        return instances[cls]

    return get_instance


@singleton
class Config:
    def __init__(self):
        self.env = "prod"


c1 = Config()
c2 = Config()
print(c1 is c2)  # True
```

---

### âš ï¸ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ ì£¼ì˜

ë©€í‹°ìŠ¤ë ˆë”© í™˜ê²½ì—ì„œ ë™ì‹œì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ë©´ **ë‘ ë²ˆ ìƒì„±ë  ìœ„í—˜**ì´ ìˆë‹¤.
ì´ë•ŒëŠ” `threading.Lock` ë“±ì„ í™œìš©í•´ ì„ê³„ êµ¬ì—­ì„ ë³´í˜¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

---

### ğŸ‘ ì¥ì 

* ì „ì—­ ìƒíƒœë¥¼ í•˜ë‚˜ë¡œ ê´€ë¦¬
* ìƒì„± ë¹„ìš©ì´ í° ê°ì²´ ì¬ì‚¬ìš© ê°€ëŠ¥
* ì–´ë””ì„œë“  ë™ì¼ ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼

### ğŸ‘ ë‹¨ì  / ì•ˆí‹°íŒ¨í„´ í¬ì¸íŠ¸

* ì „ì—­ ìƒíƒœ â†’ í…ŒìŠ¤íŠ¸/ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
* ì˜ì¡´ì„±ì´ ìˆ¨ê²¨ì ¸ ì½”ë“œ ì¶”ì ì´ í˜ë“¤ì–´ì§
* ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì•ˆì „í•œ êµ¬í˜„ì´ ê¹Œë‹¤ë¡œìš¸ ìˆ˜ ìˆìŒ

â¡ ìš”ì¦˜ì€ **DI(ì˜ì¡´ì„± ì£¼ì…)** ìœ¼ë¡œ â€œí”„ë ˆì„ì›Œí¬ê°€ ê´€ë¦¬í•˜ëŠ” ì‹±ê¸€í†¤â€ì„ ì“°ëŠ” ê²½ìš°ë„ ë§ë‹¤.

---

## 2ï¸âƒ£ íŒ©í† ë¦¬ íŒ¨í„´ (Factory Pattern)

### ğŸ“Œ ê°œë…

> ê°ì²´ ìƒì„± ë¡œì§ì„ **í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ë¶„ë¦¬**í•˜ê³ ,
> **â€œê³µì¥(Factory)â€ì´ ê°ì²´ ìƒì„±ì„ ì „ë‹´í•˜ë„ë¡ ë§Œë“œëŠ” íŒ¨í„´**

ì¦‰,

* â€œì–´ë–¤ êµ¬ì²´ í´ë˜ìŠ¤(`ConcreteA`, `ConcreteB`)ë¥¼ ë§Œë“¤ì§€â€ëŠ” íŒ©í† ë¦¬ê°€ ê²°ì •
* í´ë¼ì´ì–¸íŠ¸ëŠ” ì¸í„°í˜ì´ìŠ¤/ì¶”ìƒ íƒ€ì…ë§Œ ë³´ê³  ì‚¬ìš© â†’ **ëŠìŠ¨í•œ ê²°í•©**

---

### ğŸ§¨ ì™œ ì“°ëƒ?

1. `MyClass()` ì—¬ê¸°ì €ê¸°ì„œ ë§‰ ìƒì„± â†’ êµ¬ì²´ íƒ€ì…ì— ê°•ê²°í•©
2. íƒ€ì…ì´ ë°”ë€Œë©´ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë„ ì¼ì¼ì´ ìˆ˜ì •í•´ì•¼ í•¨
3. íŒ©í† ë¦¬ë¥¼ ë‘ë©´:

   * ìƒì„± ë¡œì§ í•œ ê³³ ì§‘ì¤‘
   * í´ë¼ì´ì–¸íŠ¸ëŠ” íƒ€ì… ë³€ê²½ ì˜í–¥ ìµœì†Œ

---

### ğŸ­ ê¸°ë³¸ ê·¸ë¦¼

```text
[Client]  --->  [Factory]  --->  [Product ì¸í„°í˜ì´ìŠ¤/ì¶”ìƒ í´ë˜ìŠ¤]
                                â†™              â†˜
                          [ConcreteA]      [ConcreteB]
```

---

## 2-1. Factory Method íŒ¨í„´ (íŒŒì´ì¬ ìŠ¤íƒ€ì¼)

> â€œ**ìƒì†**ì„ ì´ìš©í•´ ì„œë¸Œí´ë˜ìŠ¤ê°€ ì–´ë–¤ ê°ì²´ë¥¼ ìƒì„±í• ì§€ ê²°ì •í•˜ëŠ” íŒ¨í„´â€

```python
from abc import ABC, abstractmethod


# Product ì¸í„°í˜ì´ìŠ¤ (ì¶”ìƒ í´ë˜ìŠ¤)
class Product(ABC):
    @abstractmethod
    def use(self):
        pass


# êµ¬ì²´ Productë“¤
class AProduct(Product):
    def use(self):
        print("Using AProduct")


class BProduct(Product):
    def use(self):
        print("Using BProduct")


# Creator (íŒ©í† ë¦¬ì˜ ê¸°ë³¸ í‹€)
class Creator(ABC):
    @abstractmethod
    def create_product(self) -> Product:
        pass

    def some_operation(self):
        # ê³µí†µ ë¡œì§ ì•ˆì—ì„œ Productë¥¼ ì‚¬ìš©
        product = self.create_product()
        product.use()


# Concrete Creator
class ACreator(Creator):
    def create_product(self) -> Product:
        return AProduct()


class BCreator(Creator):
    def create_product(self) -> Product:
        return BProduct()


# ì‚¬ìš© ì˜ˆì‹œ
creator: Creator = ACreator()
creator.some_operation()   # Using AProduct

creator = BCreator()
creator.some_operation()   # Using BProduct
```

* í´ë¼ì´ì–¸íŠ¸ëŠ” `Creator` íƒ€ì…ì„ ì‚¬ìš©, ì‹¤ì œ ì–´ë–¤ Productê°€ ë§Œë“¤ì–´ì§€ëŠ”ì§€ëŠ” ì„œë¸Œí´ë˜ìŠ¤ê°€ ê²°ì •

---

## 2-2. Simple Factory (ì‹¤ë¬´ì—ì„œ ì œì¼ ë§ì´ ì“°ëŠ” ëŠë‚Œ)

> GoF ì •ì‹ íŒ¨í„´ ì´ë¦„ì€ ì•„ë‹ˆì§€ë§Œ, ì‹¤ë¬´ì—ì„œ â€œíŒ©í† ë¦¬â€ë¼ í•˜ë©´ ì´ í˜•íƒœê°€ ë§ìŒ

```python
class Car:
    def drive(self):
        print("Driving a car")


class Bus:
    def drive(self):
        print("Driving a bus")


class VehicleFactory:
    @staticmethod
    def create_vehicle(type_: str):
        if type_ == "car":
            return Car()
        elif type_ == "bus":
            return Bus()
        else:
            raise ValueError(f"Unknown vehicle type: {type_}")


# ì‚¬ìš© ì˜ˆì‹œ
v1 = VehicleFactory.create_vehicle("car")
v1.drive()  # Driving a car

v2 = VehicleFactory.create_vehicle("bus")
v2.drive()  # Driving a bus
```

* í´ë¼ì´ì–¸íŠ¸ëŠ” `VehicleFactory.create_vehicle("car")` ë§Œ í˜¸ì¶œ
* ì‹¤ì œ ì–´ë–¤ í´ë˜ìŠ¤ë¥¼ `new` í•˜ëŠ”ì§€ëŠ” íŒ©í† ë¦¬ ë‚´ë¶€ê°€ ì±…ì„

---

## 2-3. Abstract Factory íŒ¨í„´ (ì œí’ˆêµ° ìƒì„±)

> **ì„œë¡œ ê´€ë ¨ ìˆëŠ” ê°ì²´ ì§‘í•©(ì œí’ˆêµ°)ì„ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬**

ì˜ˆ:

* **Windows / Mac** ë³„ë¡œ Button, Checkbox, TextField ì„¸íŠ¸
* ë‹¤í¬ í…Œë§ˆ / ë¼ì´íŠ¸ í…Œë§ˆ UI ì„¸íŠ¸

```python
from abc import ABC, abstractmethod


# ===== ì¶”ìƒ Productë“¤ =====
class Button(ABC):
    @abstractmethod
    def render(self):
        pass


class Checkbox(ABC):
    @abstractmethod
    def render(self):
        pass


# ===== êµ¬ì²´ Productë“¤ =====
class WindowsButton(Button):
    def render(self):
        print("Rendering Windows Button")


class WindowsCheckbox(Checkbox):
    def render(self):
        print("Rendering Windows Checkbox")


class MacButton(Button):
    def render(self):
        print("Rendering Mac Button")


class MacCheckbox(Checkbox):
    def render(self):
        print("Rendering Mac Checkbox")


# ===== Abstract Factory =====
class GUIFactory(ABC):
    @abstractmethod
    def create_button(self) -> Button:
        pass

    @abstractmethod
    def create_checkbox(self) -> Checkbox:
        pass


# ===== Concrete Factories =====
class WindowsFactory(GUIFactory):
    def create_button(self) -> Button:
        return WindowsButton()

    def create_checkbox(self) -> Checkbox:
        return WindowsCheckbox()


class MacFactory(GUIFactory):
    def create_button(self) -> Button:
        return MacButton()

    def create_checkbox(self) -> Checkbox:
        return MacCheckbox()


# ===== í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ =====
def client_code(factory: GUIFactory):
    btn = factory.create_button()
    chk = factory.create_checkbox()
    btn.render()
    chk.render()


# ì‚¬ìš© ì˜ˆì‹œ
factory = WindowsFactory()
client_code(factory)
# Rendering Windows Button
# Rendering Windows Checkbox

factory = MacFactory()
client_code(factory)
# Rendering Mac Button
# Rendering Mac Checkbox
```

* í´ë¼ì´ì–¸íŠ¸ëŠ” `GUIFactory` ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´
* ì–´ë–¤ ì œí’ˆêµ°(Windows/Mac)ì„ ì“¸ì§€ëŠ” íŒ©í† ë¦¬ êµ¬í˜„ì²´ê°€ ê²°ì •

---

## 3ï¸âƒ£ Singleton vs Factory â€“ ì–¸ì œ ë­˜ ì“°ë‚˜?

| íŒ¨í„´            | ëª©ì                    | í‚¤ì›Œë“œ                |
| ------------- | -------------------- | ------------------ |
| **Singleton** | ì¸ìŠ¤í„´ìŠ¤ë¥¼ **í•˜ë‚˜ë§Œ** ìœ ì§€     | ì „ì—­ ê³µìœ , ì„¤ì •, ë¡œê·¸, ì»¤ë„¥ì…˜ |
| **Factory**   | ê°ì²´ ìƒì„± ë¡œì§ì„ **ìœ„ì„/ìº¡ìŠí™”** | ëŠìŠ¨í•œ ê²°í•©, í™•ì¥ì„±, OCP   |

* ê°™ì´ ì“°ëŠ” ê²ƒë„ ê°€ëŠ¥

  * ì˜ˆ: **Singleton Factory**

    * íŒ©í† ë¦¬ ì¸ìŠ¤í„´ìŠ¤ëŠ” í•˜ë‚˜ë§Œ ë‘ê³ 
    * ê·¸ íŒ©í† ë¦¬ê°€ ë‹¤ì–‘í•œ ê°ì²´ë¥¼ ìƒì„±

---