# 🌐 DNS & DHCP 정리

> 네트워크 통신에서 **주소를 관리하고 이름을 해석하는 핵심 시스템**  
> - **DNS (Domain Name System)** : 도메인 이름 → IP 주소 변환  
> - **DHCP (Dynamic Host Configuration Protocol)** : IP 주소 자동 할당

---

## 🌎 1️⃣ DNS (Domain Name System)

> 사람이 이해하기 쉬운 **도메인 이름(domain name)** 을  
> 네트워크 장비가 이해할 수 있는 **IP 주소(IP address)** 로 변환하는 시스템

---

### 📘 기본 개념

| 항목 | 설명 |
|:--|:--|
| **역할** | 도메인 이름 ↔ IP 주소 변환 |
| **계층** | 응용 계층 (OSI 7계층의 7계층) |
| **프로토콜** | UDP 53번 (기본), TCP 53번 (대용량 응답 시) |
| **데이터 단위** | Query / Response 메시지 |
| **대표 포트** | 53번 |

---

### 📡 DNS 작동 원리 (도메인 해석 과정)

> 사용자가 웹 주소(예: `www.example.com`)를 입력하면,  
> 다음 순서로 **이름 해석(Name Resolution)** 이 이루어진다.

```

사용자 PC
↓
[1] 로컬 DNS 캐시 확인 (OS/브라우저)
↓
[2] 로컬 DNS 서버(Resolver)에 질의
↓
[3] Root DNS 서버에 문의 (. 도메인)
↓
[4] TLD 서버에 문의 (.com)
↓
[5] Authoritative(권한) DNS 서버로 이동 → 실제 IP 응답
↓
[6] 로컬 DNS 서버 캐싱 후 사용자에게 IP 전달

```

---

### 📊 DNS 질의 과정 예시

| 단계 | 질의 대상 | 예시 도메인 | 결과 |
|:--:|:--|:--|:--|
| ① | Root DNS | `.` | `.com` 서버 위치 반환 |
| ② | TLD 서버 | `.com` | `example.com` 권한 서버 반환 |
| ③ | Authoritative 서버 | `example.com` | `www.example.com`의 IP 반환 |

---

### 🧩 DNS 구조

```

┌──────────────────────────┐
│   Root DNS Server (.)     │
└──────────────┬───────────┘
▼
┌───────────────┐
│ TLD (.com, .net, .kr) │
└───────────────┬────────┘
▼
┌────────────────┐
│ Authoritative   │
│ DNS (example.com) │
└────────────────┘

```

---

### 📘 DNS 레코드 유형

| 유형 | 설명 | 예시 |
|:--|:--|:--|
| **A** | 도메인 → IPv4 주소 매핑 | `www → 192.168.1.10` |
| **AAAA** | 도메인 → IPv6 주소 매핑 | `www → 2001:db8::1` |
| **CNAME** | 별칭(Alias) 설정 | `mail → www.example.com` |
| **MX** | 메일 서버 지정 | `example.com → mail.example.com` |
| **NS** | 도메인을 관리하는 네임서버 지정 | `example.com → ns1.example.com` |
| **PTR** | 역방향 IP → 도메인 이름 | `192.168.1.10 → www.example.com` |

---

### 🧠 DNS 캐싱과 TTL (Time To Live)
- 각 DNS 응답에는 **TTL(Time To Live)** 이 포함되어 있음  
  → 캐시가 유지되는 시간(초 단위)
- TTL이 만료되면 새로 질의 수행
- 캐싱 계층: 브라우저 → OS → 로컬 DNS 서버

---

### ⚡ DNS 단점 및 보완 기술
| 한계 | 보완 기술 |
|:--|:--|
| 평문 전송 → 스푸핑/가로채기 위험 | **DNSSEC**, **DoH(DNS over HTTPS)** |
| 중앙 집중적 구조 | Anycast, 분산 DNS 서버 구조 |

---

## 🖥 2️⃣ DHCP (Dynamic Host Configuration Protocol)

> 네트워크에 접속하는 장치(클라이언트)에게  
> **IP 주소 및 네트워크 설정 정보를 자동으로 할당**하는 프로토콜

---

### 📘 기본 개념

| 항목 | 설명 |
|:--|:--|
| **역할** | IP 주소 자동 할당 및 관리 |
| **계층** | 응용 계층 (UDP 기반) |
| **프로토콜** | UDP 67번(서버), 68번(클라이언트) |
| **데이터 단위** | Offer / Request / Ack 메시지 |
| **대표 장비** | DHCP Server (공유기, 라우터 등) |

---

### 📡 DHCP 작동 과정 (DORA 과정)

> DHCP는 **DORA**(Discover–Offer–Request–Ack) 4단계를 거쳐  
> 클라이언트에게 IP를 자동으로 부여한다.

```

Client                            DHCP Server
│                                     │
①  │ --- Discover ---------------------> │  (IP 요청 브로드캐스트)
②  │ <--- Offer ------------------------ │  (IP 제안)
③  │ --- Request ----------------------> │  (특정 IP 요청)
④  │ <--- Ack -------------------------- │  (IP 할당 완료)

```

---

### 🧩 DORA 상세 설명

| 단계 | 명칭 | 설명 |
|:--|:--|:--|
| **① Discover** | IP 주소 요청 | 클라이언트가 네트워크에 “누가 DHCP 서버야?” 브로드캐스트 |
| **② Offer** | IP 주소 제안 | 서버가 사용 가능한 IP 주소를 제안 |
| **③ Request** | IP 주소 요청 | 클라이언트가 그중 하나를 선택해 요청 |
| **④ Acknowledgment** | IP 주소 확정 | 서버가 해당 IP를 클라이언트에 할당 |

---

### 📊 DHCP 서버가 전달하는 정보

| 항목 | 설명 | 예시 |
|:--|:--|:--|
| **IP 주소** | 클라이언트 장치에 부여되는 주소 | `192.168.0.10` |
| **서브넷 마스크** | 네트워크 구분자 | `255.255.255.0` |
| **기본 게이트웨이** | 외부 네트워크로 나가는 출입구 | `192.168.0.1` |
| **DNS 서버 주소** | 이름 해석용 서버 주소 | `8.8.8.8` |
| **임대 기간(Lease Time)** | IP 사용 가능 기간 | `24시간` 등 |

---

### 🔄 IP 재할당 (Renew / Rebind)
- **T1(50%) 시점**: 기존 DHCP 서버에 갱신 요청  
- **T2(87.5%) 시점**: 응답이 없을 경우 다른 서버에 재요청  
- 임대 기간 만료 시 IP 반납

---

### ⚠️ DHCP 관련 문제

| 문제 | 원인 | 해결 방법 |
|:--|:--|:--|
| IP 충돌 | 여러 서버 존재, 고정 IP 중복 | DHCP 서버 단일화 |
| 임대 만료 | 장기간 오프라인 | 재요청 시 자동 재할당 |
| DHCP 서버 미응답 | 네트워크 분리, 브로드캐스트 차단 | 릴레이(DHCP Relay) 사용 |

---

### 📡 DHCP Relay Agent
- DHCP 서버가 다른 네트워크에 있을 때 **중계 역할 수행**
- **브로드캐스트 → 유니캐스트** 변환
- 라우터가 DHCP Relay 역할을 수행함

```

[Client] → DHCP Discover (Broadcast)
→ [Relay Agent] → DHCP Server (Unicast)

```

---

## 🔍 DNS vs DHCP 비교

| 구분 | **DNS** | **DHCP** |
|:--|:--|:--|
| **역할** | 도메인 ↔ IP 주소 변환 | IP 주소 자동 할당 |
| **계층** | 응용 계층 (UDP 53) | 응용 계층 (UDP 67/68) |
| **통신 방향** | 클라이언트 ↔ 서버 (쿼리/응답) | 클라이언트 ← 서버 (할당) |
| **작동 시점** | 웹 접근 시마다 | 네트워크 접속 시 1회 |
| **주요 구성요소** | Resolver, Root/TLD/Authoritative DNS | DHCP Server, Client, Relay |
| **출력 결과** | IP 주소 | IP, Subnet, Gateway, DNS 설정 |
| **상호 관계** | DNS는 이름 해석, DHCP는 주소 제공 | DHCP가 DNS 서버 주소를 함께 제공 가능 |

---

## ✅ 핵심 요약

| 항목 | 요약 |
|:--|:--|
| **DNS** | 도메인 이름을 IP 주소로 변환하는 시스템 |
| **DHCP** | 네트워크 장치에 IP 주소를 자동으로 부여하는 프로토콜 |
| **공통점** | IP 주소 관리와 네트워크 자동화에 기여 |
| **차이점** | DNS는 “이름 → 주소”, DHCP는 “주소 → 할당” |
| **연동** | DHCP가 DNS 서버 주소를 함께 제공하여 자동 설정 가능 |

---

> ✅ **한줄 요약:**  
> - **DNS**: "도메인을 IP로 바꿔주는 전화번호부"  
> - **DHCP**: "IP를 자동으로 빌려주는 관리인"  
>  
> 두 시스템이 함께 작동함으로써  
> 사용자는 **IP를 신경 쓰지 않고 이름만으로 통신**할 수 있다.
```

