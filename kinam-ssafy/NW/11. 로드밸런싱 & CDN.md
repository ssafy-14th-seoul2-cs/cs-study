# 로드밸런싱 & CDN 정리

## 1. CDN (Content Delivery Network)

### CDN이란?

콘텐츠 전송 네트워크는 서비스를 이용하는 사용자에게 콘텐츠를 빠르게 배포하기 위한 콘텐츠 가속 솔루션

사용자가 웹사이트를 방문할 때, 웹 사이트 서버의 데이터는 인터넷을 통해 이동해야 함. 사용자가 해당 서버에서 멀리 떨어져 있는 경우 대용량 파일을 로드하는 데 오랜 시간이 걸림

### CDN 사용 목적

- **대기 시간 감소**: 네트워크 설계로 인해 발생하는 통신 지연 감소
- 클라이언트와 웹 서버 간의 중간 서버를 두어 효율성을 높임
- 웹 트래픽을 감소시키고 대역폭 소비를 줄여 전체적인 사용자 환경을 개선

### CDN 작동 방식

#### 캐싱

캐싱은 더 빠른 데이터 액세스를 위해 동일한 데이터의 여러 복사본을 저장하는 프로세스. CDN에서는 정적 웹 사이트 콘텐츠를 저장하는 프로세스를 의미함

**동작 과정:**
1. 지리적으로 멀리 떨어진 웹 방문자가 사이트에서 정적 웹 콘텐츠를 '처음' 요청
2. 요청이 웹 서버 또는 오리진 서버에 도달
3. 오리진 서버는 원격 방문자에게 응답을 보내고, 해당 방문자와 지리적으로 가까운 CDN POP에 응답 복사본을 보냄
4. CDN POP 서버는 복사본을 캐싱된 파일로 저장
5. 다음에 해당 방문자가 요청하면, 오리진 서버가 아닌 캐싱 서버가 응답

#### 동적 가속

사용자 요청이 있을 때마다 콘텐츠가 변경될 수 있기 때문에, 동적 웹 콘텐츠에서는 캐싱이 제대로 작동하지 않음

동적 가속을 통해 동적 웹 콘텐츠 요청에 대한 서버 응답 시간을 단축

### CDN 사용 이점

#### 대역폭 비용 절감
캐싱 및 기타 최적화를 통해 CDN이 오리진 서버가 제공해야 하는 데이터의 양을 줄여, 웹 사이트 소유자의 호스팅 비용을 절감

#### 웹사이트 보안 강화
DDoS 분산 사이트 거부 공격은 대량의 가짜 트래픽을 웹 사이트로 전송하여 애플리케이션이 작동 중지 되도록 만듦. CDN은 여러 중간 서버간에 로드를 분산하여, 오리진 서버에 미치는 영향을 줄여 트래픽 급증을 처리

#### 페이지 로드 시간 단축
페이지 로드 시간이 너무 느리면, 웹 사이트 트래픽 감소 위험이 있음. CDN을 통해 반송률을 줄이고 사용자가 사이트에서 보내는 시간을 늘릴 수 있음

---

## 2. 로드밸런서 (Load Balancer)

### 로드밸런서란?

서버나 장비의 부하를 분산하기 위해 사용하는 장비

작은 시스템이 많이 있는 상태여도, 사용자는 서버 배치와 상관없이 하나의 서비스로 보여야 하며, 부하를 감당하지 못하는 서버들을 로드밸런서가 다운되지 않도록 도와줌

### 스케일 업 vs 스케일 아웃

많은 트래픽이 몰릴 경우 부하를 감당하지 못하고, 서버가 다운되어 서비스가 작동을 멈출 수 있음

#### Scale Up (스케일 업)
기존 서버의 성능을 향상시킴. CPU나 메모리를 업그레이드 시키는 것과 같은 작업을 포함

#### Scale Out (스케일 아웃)
작업을 여러대 서버에 분산시켜서 처리하는 방법

### 로드 밸런싱 알고리즘

#### 1. 정적 로드 밸런싱

**라운드 로빈 방식 (Round Robin Method)**
- 클라이언트의 요청을 여러 대의 서버에 순차적으로 분배하는 방식
- 예: A, B, C의 서버를 갖고 있는 경우 A → B → C → A 순서대로 순회

**가중치 기반 라운드 로빈 방식 (Weighted Round Robin)**
- 각 서버마다 가중치(Weight)를 매기고 가중치가 높은 서버에 클라이언트 요청을 먼저 배분
- 예: A=8, B=2, C=3 → A에게 8개, B에게 2개, C에게 3개의 Request를 할당

**IP 해시 방식 (IP Hash)**
- 로드밸런서가 클라이언트 IP 주소에 대해 해싱을 진행하여 개별 서버에 매핑
- 해싱을 통해 부하를 분산하고, 항상 동일한 서버로 연결되는 것을 보장

#### 2. 동적 로드 밸런싱

**최소 연결 방법 (Least Connection)**
- 활성 연결이 가장 적은 서버를 확인하고, 해당 서버로 트래픽을 전송

**최소 응답 시간 방법 (Least Response Time)**
- 가장 짧은 응답 시간을 보내는 서버로 트래픽을 할당

### 로드 밸런서 주요 기능

#### SSL 인증 설정
CA에서 발급받은 SSL 인증서를 Certificate Manager에 등록 후 적용 가능

#### 로드밸런서 모니터링
Concurrent Connection, Traffic 등 모니터링 항목 제공

#### 세션 관리
Connection idle timeout, HTTP keep-alive 설정 가능

#### NAT (Network Address Translation)
사설 IP주소를 공인 IP주소로 바꾸는데 사용하는 통신망의 주소 변조

#### 보안
L7 로드밸런서의 경우 애플리케이션 계층(HTTP, FTP)에서 로드를 분산하기 때문에 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능. 패킷을 미리 확인하고 그 내용에 따른 분산이 가능. DoS/DDoS와 같은 비정상적인 트래픽을 필터링 할 수 있어 보안적 이점이 존재

---

## 3. CDN vs 로드밸런서

### 공통점

- 프로그램과 사용자간의 원활한 데이터 흐름 전개를 도와줌
- 서버 네트워크에 데이터를 배포 가능

### 차이점

#### CDN의 주요 목적
넓은 지리적 영역에 콘텐츠를 분산시켜서 전 세계의 사용자에게 일관된 경험을 제공하며 먼 지역에서도 콘텐츠 접근 속도를 높임

#### 로드밸런서의 주요 목적
주로 지리적으로 가까운 서버들 사이에 트래픽을 균등하게 분산시키는 역할. 서버 클러스터의 부하를 효율적으로 관리하고, 시스템의 가동 시간과 성능을 최적화하는데 필수적

### 사용 시나리오

#### 예시 1: 두 도구 모두 사용
많은 사용자들에게 프로그램을 제공해야하는 경우
- 로드 밸런서: 서버 클러스터의 부하를 분산시켜 시스템의 안전성과 성능 보장
- CDN: 지리적으로 분산된 사용자들에게 콘텐츠를 신속하게 전달하여 사용자 경험을 개선

#### 예시 2: 상황별 선택
- **로드밸런서가 더 중요한 경우**: 사용자 기반이 서버 클러스터+로드밸런서를 요구할 만큼 크지만, 대부분 동일한 지역에 있을 경우
- **CDN만으로 충분한 경우**: 지리적으로 분산된 사용자들이 많지만 특정 지역에서만 서버 클러스터가 필요한 경우

### 결론

로드 밸런서와 CDN은 각각의 고유한 역할을 하며, 현대의 응용 프로그램 제공과 호스팅에서 중요한 도구. 이들 도구를 적절히 조합하면 서버와 클라이언트 간의 상호작용을 최적화할 수 있음

보통 두 도구가 함께 사용됨