## DB Lock & 동시성 제어

### DB Lock (데이터베이스 잠금)

1. 정의

- 트랜잭션 간 충돌을 방지하고, 데이터에 대한 동시 접근을 제어하기 위해 사용되는 기법
- 락을 사용하면 하나의 트랜잭션이 데이터를 수정하는 동안 다른 트랜잭션이 그 데이터를 수정하거나 읽지 못하도록 막을 수 있음

2. 종류

- 공유 잠금(Shareed Lock, S-lock)
    - 여러 트랜잭션이 동시에 데이터 읽기 허용, 수정 X
    - ex. `SELECT` 쿼리에서 사용
- 배타 잠금(Exclusive Lock, X-lock)
    - 한 트랜잭션이 데이터 수정하는 동안 다른 트랜잭션은 해당 데이터에 접근 불가
    - ex. `UPDATE`나 `DELETE` 쿼리에서 사용

3. 블로킹(Blocking)

- 잠금들의 경합(Race Condition)이 발생하여 특정 세션이 작업을 진행하지 못하고 멈춰 선 상태
- 공유 장금 - 배타 잠금, 배타 잠금 - 배타 잠금끼리 발생 가능
- 해결 : 이전 트랜잭션 완료(commit or rollback)

4. 교착 상태(Deadlock)

- 두 개 이상의 트랜잭션이 서로가 가진 락을 기다리며, 무한히 대기하는 상태
- 해결 : DBMS의 교착 상태 감지, 교착 상태 회피 알고리즘 사용

---

### 동시성 제어

1. 정의

- 여러 트랜잭션이 동시에 실행될 때, 데이터 일관성을 보장하고 경쟁 조건을 피하는 기법
- 여러 사용자가 데이터베이스를 접근해도 데이터가 손상되지 않도록 함

2. 목표

- 격리성(Isolation) : 한 트랜잭션의 실행 결과가 다른 트랜잭션에 영향을 주지 않도록 보장
- 일관성(Consistency) : 트랜잭션 실행 후 데이터베이스는 일관된 상태여야 함
- 병행성(Parallelism) : 여러 트랜잭션을 동시에 실행하되, 그 결과가 일관성 있게 유지되어야 함

3. 문제 유형

- 더티 리드(Dirty Read) : 다른 트랜잭션이 아직 커밋되지 않은 데이터를 읽는 현상
- 비결정적 읽기(Non-repeatable Read) : 한 트랜잭션이 읽은 데이터가다른 트랜잭션에 의해 변경되는 현상
- 팬텀 리드(Phantom Read) : 트랜잭션이 실행 중 데이터 집합이 변경되는 현상

4. 동시성 제어 알고리즘

- 2단계 잠금(Two-Phase Locking, 2PL)
    - 트랜잭션이 모든 락을 얻은 후에는 락 해제 불가능, 트랜잭션이 완료될 때까지 모든 자원 잠근 후 락 해제
    - 교착 상태 방지, 성능에 영향
- Optimistic Concurrency Control(OCC)
    - 트랜잭션이 락을 사용하지 않고, 검증 단계에서 충돌을 발견하면 롤백
    - 낙관적으로 동시성 허용, 트랜잭션이 충돌할 확률이 낮을 때 성능 좋음